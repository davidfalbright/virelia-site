<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Website Infrastructure Tracker — V.I.R.E.L.I.A.</title>
<link rel="stylesheet" href="styles.css" />
<style>
  body { font-family: Arial, sans-serif; background:#0b0d10; color:#e5eef7; }
  .container { max-width: 1000px; margin: 2rem auto; padding: 1rem; }
  table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
  th, td { border: 1px solid #1f2937; padding: 8px; text-align: left; }
  th { background: #131823; }
  tr:nth-child(even) { background: #101318; }
  .btn { padding: 0.5rem 1rem; margin: 0.25rem; cursor: pointer; background:#6fb2ff; color:#0b0d10; border:none; border-radius:4px; }
  .btn:disabled { background:#444; cursor: not-allowed; }
  .msg { margin-top: 1rem; }
  .ok { color: #10b981; }
  .err { color: #ef4444; }
  .form-inline { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 1rem; }
  .form-inline input { padding: 0.25rem; flex: 1 1 150px; }
</style>
</head>
<body>
<div class="container">
  <h1>Website Infrastructure Tracker</h1>
  <p>Track your websites, hosting platforms, source code repositories, email providers, and account creation services.</p>

  <div class="form-inline">
    <input id="websiteInput" placeholder="Website URL" />
    <input id="platformInput" placeholder="Hosting Platform" />
    <input id="repoInput" placeholder="Source Repo (GitHub, etc.)" />
    <input id="accountEmailInput" placeholder="Account Email" />
    <input id="accountServiceInput" placeholder="Account Service (ReSend, Zoho, etc.)" />
    <button id="addBtn" class="btn">Add Record</button>
  </div>

  <div>
    <button id="refreshBtn" class="btn">Refresh</button>
    <button id="saveBtn" class="btn">Save to Blob</button>
  </div>

  <table id="trackerTable">
    <thead>
      <tr>
        <th>Website</th>
        <th>Platform</th>
        <th>Source Repo</th>
        <th>Account Email</th>
        <th>Account Service</th>
        <th>Last Updated</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <tr><td colspan="6">Loading…</td></tr>
    </tbody>
  </table>

  <p id="status" class="msg"></p>
</div>

<script type="module">
import { getStore } from "@netlify/blobs";

const siteID = "<YOUR_NETLIFY_SITE_ID>";
const token  = "<YOUR_NETLIFY_BLOBS_TOKEN>";
const storeName = "site_infra";

const store = getStore({ name: storeName, siteID, token });

const tableBody = document.getElementById("tableBody");
const statusEl = document.getElementById("status");
const refreshBtn = document.getElementById("refreshBtn");
const saveBtn = document.getElementById("saveBtn");
const addBtn = document.getElementById("addBtn");

const websiteInput = document.getElementById("websiteInput");
const platformInput = document.getElementById("platformInput");
const repoInput = document.getElementById("repoInput");
const accountEmailInput = document.getElementById("accountEmailInput");
const accountServiceInput = document.getElementById("accountServiceInput");

function setMsg(text, ok=false){
  statusEl.textContent = text || "";
  statusEl.className = 'msg ' + (ok ? 'ok' : 'err');
}

async function loadTable() {
  setMsg('');
  tableBody.innerHTML = '<tr><td colspan="6">Loading…</td></tr>';
  try {
    const raw = await store.get("sites");
    const entries = raw ? JSON.parse(raw) : [];
    if (!entries.length) {
      tableBody.innerHTML = '<tr><td colspan="6"><em>No entries found.</em></td></tr>';
      return;
    }

    tableBody.innerHTML = '';
    for (const e of entries) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${e.website || ''}</td>
        <td>${e.platform || ''}</td>
        <td>${e.repo || ''}</td>
        <td>${e.accountEmail || ''}</td>
        <td>${e.accountService || ''}</td>
        <td>${e.updatedAt ? new Date(e.updatedAt).toLocaleString() : 'N/A'}</td>
      `;
      tableBody.appendChild(row);
    }
  } catch(err){
    tableBody.innerHTML = '<tr><td colspan="6">Failed to load data</td></tr>';
    console.error(err);
    setMsg("Failed to load table", false);
  }
}

async function saveTable() {
  try {
    const rows = Array.from(tableBody.querySelectorAll("tr"));
    const data = rows.map(r => {
      const cells = r.querySelectorAll("td");
      if (cells.length !== 6) return null;
      return {
        website: cells[0].textContent.trim(),
        platform: cells[1].textContent.trim(),
        repo: cells[2].textContent.trim(),
        accountEmail: cells[3].textContent.trim(),
        accountService: cells[4].textContent.trim(),
        updatedAt: new Date().toISOString()
      };
    }).filter(Boolean);

    await store.set("sites", JSON.stringify(data));
    setMsg("Saved successfully!", true);
  } catch(err){
    console.error(err);
    setMsg("Failed to save table", false);
  }
}

addBtn.addEventListener('click', async () => {
  const website = websiteInput.value.trim();
  const platform = platformInput.value.trim();
  const repo = repoInput.value.trim();
  const accountEmail = accountEmailInput.value.trim();
  const accountService = accountServiceInput.value.trim();

  if (!website || !platform || !accountEmail) {
    setMsg("Website, Platform, and Account Email are required.", false);
    return;
  }

  try {
    const raw = await store.get("sites");
    const entries = raw ? JSON.parse(raw) : [];
    entries.push({
      website, platform, repo, accountEmail, accountService,
      updatedAt: new Date().toISOString()
    });
    await store.set("sites", JSON.stringify(entries));

    websiteInput.value = platformInput.value = repoInput.value = accountEmailInput.value = accountServiceInput.value = '';
    setMsg("Record added!", true);
    loadTable();
  } catch(err){
    console.error(err);
    setMsg("Failed to add record", false);
  }
});

refreshBtn.addEventListener('click', loadTable);
saveBtn.addEventListener('click', saveTable);

// Initial load
loadTable();
</script>
</body>
</html>
